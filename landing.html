<!DOCTYPE html>
<html lang="en">

<head>
    <title>What The WFH</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

</head>


<body>
    <h1>Productivity Tracker</h1>


    <label for="Date">Date : </label>
    <input type="date" name="date" id="date">

    <button onclick="util()">Analyse</button>



    <div class="container">
        <div class="row">
            <div id="res" class="col-6">

            </div>

            <div class="col-6">
                <div class="row">
                    <canvas id="myChart" width="50" height="50"></canvas>
                </div>
                <div class="row" id="tot">

                </div>
                <div class="row" id="nop">

                </div>
                <div class="row" id="op">

                </div>
            </div>
        </div>
    </div>






    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"
        integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js"
        integrity="sha512-zO8oeHCxetPn1Hd9PdDleg5Tw1bAaP0YmNvPY8CwcRyUk7d7/+nyElmFrB6f7vg4f7Fv4sui1mcep8RIEShczg=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js"
        integrity="sha512-SuxO9djzjML6b9w9/I07IWnLnQhgyYVSpHZx0JV97kGBfTIsUYlWflyuW4ypnvhBrslz1yJ3R+S14fdCWmSmSA=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.css"
        integrity="sha512-C7hOmCgGzihKXzyPU/z4nv97W0d9bv4ALuuEbSf6hm93myico9qa0hv4dODThvCsqQUmKmLcJmlpRmCaApr83g=="
        crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"
        integrity="sha512-hZf9Qhp3rlDJBvAKvmiG+goaaKRZA6LKUO35oK6EsM0/kjPK32Yw7URqrq3Q+Nvbbt8Usss+IekL7CRn83dYmw=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css"
        integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w=="
        crossorigin="anonymous" />


    <script>
        var Labels, Data, borderc, bg;
        function drawPIE() {
            var ctx = document.getElementById('myChart');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Labels,
                    datasets: [{
                        label: 'Time Spent',
                        data: Data,
                        backgroundColor: bg,
                        borderColor: borderc,
                        borderWidth: 0
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        }



        function getTime(inp) {
            var hr, min, sec;
            hr = min = sec = 0;
            var final = "";
            if (inp / 3600 >= 1) {
                final += Math.trunc(inp / 3600) + "hrs ";
                inp = inp % 3600;
            }
            if (inp / 60 >= 1) {
                final += Math.trunc(inp / 60) + "mins ";
                inp = inp % 60;
            }
            if (inp > 0)
                final += inp + "secs";
            return final;

        }

        var tot, prod, non_prod, i;
        const electron = require('electron');
        const { ipcRenderer } = electron;
        function util() {

            tot = 0;
            prod = 0;
            non_prod = 0;

            let item = document.getElementById('date').value;
            ipcRenderer.send('date', item);
        }

        ipcRenderer.on('results', function (e, ress) {
            Labels = [];
            Data = [];
            bg = [];
            borderc = [];
            var alltrack = ress.split('*');

            let u_list = document.getElementById('res');
            if (alltrack.length) {
                for (i = 0; i < alltrack.length; i++) {
                    var arr = alltrack[i].split('|');
                    if (arr.length != 3)
                        continue;
                    Labels.push(arr[0]);
                    Data.push(parseInt(arr[1]));
                    bg.push("#" + Math.floor(Math.random() * 16777215).toString(16));
                    borderc.push("#" + Math.floor(Math.random() * 16777215).toString(16));
                    let new_div = document.createElement('div');
                    new_div.setAttribute('class', 'row');

                    if (arr[2] === "true") {
                        new_div.setAttribute('style', 'color: green');
                        prod += parseInt(arr[1]);
                    }
                    else {
                        new_div.setAttribute('style', 'color: red');
                        non_prod += parseInt(arr[1]);
                    }
                    new_div.innerHTML = arr[0] + "<br>" + getTime(parseInt(arr[1])) + "<br>";

                    u_list.appendChild(new_div);
                    tot += parseInt(arr[1]);

                }
                drawPIE();

                document.getElementById('tot').innerHTML = "Total Time: " + getTime(tot);
                document.getElementById('op').innerHTML = "Productive Time: " + getTime(prod);
                document.getElementById('nop').innerHTML = "Unproductive Time: " + getTime(non_prod);


            }
            else {
                let new_div = document.createElement('div');
                new_div.setAttribute('class', 'row');
                new_div.innerHTML = "No data found <br> Please try another day";
                u_list.appendChild(new_div);

            }
        });



        window.onload(e, function () {

        })




    </script>



</body>

</html>